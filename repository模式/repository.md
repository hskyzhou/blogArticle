# Laravelä¸­Repositoryæ¨¡å¼æµ…è§

`åœ¨laravelå¼ºå¤§çš„ormå‰æï¼Œä¸ºä»€ä¹ˆè¿˜è¦å»è€ƒè™‘repositoryæ¨¡å¼ï¼Œæ˜¯å¦å¤šæ¬¡ä¸€ä¸¾ï¼Ÿ`
******

> åœ¨è®¨è®ºæ­¤é—®é¢˜ä¹‹å‰ï¼Œå…ˆç®€å•çš„å›é¡¾ä¸€ä¸‹Orm
> æ—¢ç„¶å…ˆè¦è®¨è®ºä¸€ä¸‹ormï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œé‚£ä»€ä¹ˆæ˜¯ormï¼Œ ormåˆ°åº•åˆèƒ½å¹²ä»€ä¹ˆå‘¢

## ä»€ä¹ˆæ˜¯Orm -- Object Relational Mapping
ç¿»å¼€`Eloquent/Model` è¿™ä¸ªæ–‡ä»¶ã€‚æ•´æ•´3596è¡Œã€‚æˆ–è€…ç¬¬ä¸€çœ¼å°±ä¼šå“è·‘å¾ˆå¤šæƒ³è¦äº†è§£ä»–çš„äººğŸ™ƒ
é‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶åˆ°åº•æœ‰ä»€ä¹ˆï¼Œåˆæˆ–è€…å®ƒèƒ½å¤„ç†ä»€ä¹ˆï¼Ÿ

### Laravel Ormæœ‰ä»€ä¹ˆ
1. Domain Model (Data Model å’Œ é¢†åŸŸé€»è¾‘)
2. Row Data Gatewayï¼ˆä¾‹å¦‚saveï¼Œdeleteç­‰æ•°æ®æŒä¹…åŒ–æ“ä½œï¼‰
3. Table Data Gatewayï¼ˆå„ç§findæ–¹æ³•ï¼‰
4. Factory (æ–°å»ºmodel)
### ä½¿ç”¨æ„Ÿè§‰
> é‚£ä¹ˆå¦‚æœå¼ºå¤§ï¼Œç”šè‡³å¯ä»¥è¯´æ˜¯æ— æ‰€ä¸èƒ½çš„Modelï¼Œæ˜¯ä¸æ˜¯ä½¿ç”¨èµ·æ¥ä¹Ÿæ˜¯å¦‚æ­¤çš„å¾—å¿ƒåº”æ‰‹å‘¢ï¼Ÿ
> ä½†æ˜¯äº‹æƒ…ä¸åƒæœŸå¾…çš„é‚£ä¹ˆç¾å¥½ï¼Œæˆ–è®¸æ˜¯å¤§è¥¿æ´‹é‚£é‡Œçš„è´è¶ä¸å°å¿ƒæ‰‡äº†ä¸‹ç¿…è†€ã€‚
é‚£ä¹ˆéœ€æ±‚å¦‚ä¸‹ï¼š
1. éœ€æ±‚1: æˆ‘è¦è·å–æ‰€æœ‰çš„ç”¨æˆ·åˆ—è¡¨ï¼Œ ä¸€å¬è¿™ä¸ªéœ€æ±‚ï¼Œä½ å°±è¯´ï¼Œè¿™ä¸ªå¤ªç®€å•äº†ã€‚ormé‡Œé¢æœ‰`all` æ–¹æ³•ï¼Œæˆ‘å¯ä»¥ç›´æ¥å®Œæˆ
2. éœ€æ±‚2: æˆ‘è¦è·å–ç”¨æˆ·åæ˜¯`hsky`çš„ç”¨æˆ·åˆ—è¡¨ã€‚è¿™æ—¶å€™ä½ ä¸€å¬ï¼Œè¿™ä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘åªè¦whereä¸€æ ·ï¼Œç…§æ ·åˆ†åˆ†é’Ÿå°±æå®šäº†ã€‚ç›´æ¥ç”¨`where(name, 'hsky')`å°±å®Œäº‹äº†ã€‚
> ä½ çš„çœŸçš„ä»¥ä¸ºäº‹æƒ…å°±è¿™æ ·æ„‰å¿«çš„ç»“æŸäº†ã€‚é‚£æˆ‘ä¹Ÿåªèƒ½ğŸ™ƒğŸ™ƒğŸ™ƒä¸‹äº†ã€‚
3. æ–°éœ€æ±‚åˆæ¥äº†ï¼Œå˜æˆäº†ã€‚æˆ‘éœ€è¦ä¸€ä¸ªçŠ¶æ€æ˜¯opençš„ï¼Œç”¨æˆ·åæ˜¯hskyçš„ç”¨æˆ·åˆ—è¡¨ï¼Œè¿™æ—¶å€™ï¼Œæœ‰å·´æ‹‰å·´æ‹‰çš„æ•²äº†å‡ åˆ†é’Ÿï¼ŒåŠŸèƒ½åˆå¥½äº†ï¼Œå¼€å¼€å¿ƒå¿ƒçš„å®Œå·¥ï¼Œå®Œæˆå¦‚ä¸‹`where(name, 'hsky')->where('status', 1)`,
> åˆ°è¿™é‡Œå…ˆæ•´ç†ä¸€ä¸‹ï¼Œallæ˜¯ormè‡ªå¸¦äº†,ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å†™ï¼Œé‚£ä¹ˆéœ€æ±‚2å’Œéœ€æ±‚3ï¼Œæœ‰å¥½å‡ ç§å¤„ç†æ–¹æ³•ã€‚ç¬¬ä¸€ç§ï¼Œä¸€ä¸ªæ–¹æ³•è·å–ä¸€ç§æ•°æ®ï¼Œæ©ï¼Œçš„ç¡®ï¼Œå¾ˆç®€å•æ˜äº†ï¼Œä¹Ÿæ–¹ä¾¿ç»´æŠ¤ï¼Œè¿˜æ˜¯å¯é‡ç”¨ã€‚ç¬¬äºŒç§ï¼Œæœ‰äººè¯´äº†ï¼Œæˆ‘å¯ä»¥å¹¶åˆ°ä¸€èµ·å¤„ç†ï¼Œå†™ä¸€ä¸ªæ–¹æ³•ï¼Œä¼ ä¸¤ä¸ªå‚æ•°å°±å¥½äº†ï¼Œé¦–å…ˆå› ä¸ºå‚æ•°æ•°é‡ä¸å¤šï¼Œå®Œå…¨å¯ä»¥æ¥å—ï¼Œè€Œä¸”åˆèƒ½å‡å°‘ä»£ç ï¼Œæ ¼å¼ä¹Ÿçœ‹èµ·æ¥æ¯”è¾ƒæ•´æ´ï¼Œä¼¼ä¹ä¹Ÿæ˜¯å¾ˆä¸é”™çš„é€‰æ‹©ã€‚ç¬¬ä¸‰ç§ï¼ŒåŠ å…¥scopeå…ƒç´ ï¼Œç­‰ç­‰ï¼Œæ–¹æ³•å¾ˆå¤šçš„ã€‚é‚£ä¹ˆç»“æœåˆ°åº•å¦‚ä½•ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ä¸‹å»ã€‚
4. éœ€æ±‚4ï¼šæˆ‘éœ€è¦ç”¨äºæ‰‹æœºå·æ˜¯135å¼€å¤´ï¼Œå¹´é¾„>18å²çš„ã€‚è¿™æ—¶å€™ï¼Œè¯¥å†™æ–¹æ³•çš„ç»§ç»­å†™æ–¹æ³•ï¼Œæ”¹åŠ å‚æ•°çš„ç»§ç»­åŠ å‚æ•°ã€‚
> ç„¶è€Œæˆ‘ä»¬å†™è¿‡æ¨¡å—çš„ï¼Œéƒ½çŸ¥é“ï¼Œæœ‰æ—¶å€™æœ‰çš„æ¨¡å—å¯èƒ½ä»…ä»…åªéœ€è¦æœ€ç®€å•çš„å¢åˆ æ”¹æŸ¥ï¼Œä½†æ˜¯æœ‰æ—¶å€™æœ‰çš„æ¨¡å—è¦å¤„ç†å¤æ‚çš„æ•°æ®ï¼Œå¤æ‚çš„ä¸šåŠ¡æµç¨‹ã€‚å…·ä½“ä¸‹é¢è¯¦ç»†è¯´ã€‚

### ç»“è®ºï¼š
å¯¹äºä¸€èˆ¬çš„å°é¡¹ç›®ï¼Œæ¯”å¦‚å†™ä¸ªå•é¡µä¹‹ç±»çš„ï¼Œçš„çš„ç¡®ç¡®ï¼Œä¸€ä¸ªmodelå®Œå…¨èƒ½å¤Ÿæå®šæ‰€æœ‰çš„äº‹æƒ…ï¼Œä»€ä¹ˆRepositoryï¼Œä»€ä¹ˆContractsï¼Œéƒ½æ˜¯ä¸€å †æ¸£æ¸£ï¼Œæˆ–è€…è¯´æ˜¯å¤šæ­¤ä¸€ä¸¾ã€‚ç„¶è€Œé¡¹ç›®éƒ½æ˜¯è¶Šæ¥è¶Šå®Œå–„ï¼Œè¶Šåšè¶Šå¤§ï¼Œè¶Šåšè¶Šå…·ä½“çš„ã€‚ä½ åŠ¿å¿…ä¼šè§‰å¾—ï¼Œormè¶Šæ¥è¶ŠåƒåŠ›ï¼Œä»£ç è¶Šæ¥è¶Šä¸æ˜“ç»´æŠ¤ï¼Œè¶Šæ¥è¶Šä¸æƒ³å»çœ‹ç¬¬äºŒéï¼Œç”šè‡³åœ¨æƒ³ï¼Œå“å‘€ï¼Œå°±è¿™æ ·å§ã€‚`ç­‰æˆ‘å“ªå¤©æœ‰æ—¶é—´å†å»é‡æ„å§`ã€‚æœ€åè¿™ä¸ªå“ªä¸€å¤©æ°¸è¿œæ˜¯é‚£ä¹ˆçš„é¥é¥æ— æœŸã€‚æœ€åå˜æˆï¼Œè‡ªå·±ä¹Ÿä¸æ„¿æ„å»çœ‹çš„çƒ‚å¤§è¡—ä»£ç ã€‚é‚£ä¹ˆæœ‰ä»€ä¹ˆèƒ½é¿å…è¿™ç§é—®é¢˜ï¼Œæˆ–è€…èƒ½å¤Ÿè§£å†³è¿™ç§é—®é¢˜å‘¢ï¼Ÿ


> è¿›å…¥ä¸»é¢˜ä¹‹å‰ï¼Œå…ˆè¯´æ®µä¸ªäººæ„Ÿæƒ³å§ã€‚çœŸäººçœŸé¡¹ç›®çœŸäº‹æƒ…ã€‚
> äº‘å¹³å°é¡¹ç›®ï¼Œæˆ–è®¸çŸ¥é“çš„äººä¸å¤šï¼Œä½†æ˜¯ä»Šå¤©ä¸æ˜¯æ¥è¯´é¡¹ç›®æ˜¯å¦‚ä½•å¦‚ä½•çš„å¤æ‚ï¼Œæ˜¯å¦‚ä½•å¦‚ä½•éš¾ä»¥ç†è§£ï¼Œè¿™äº›ä¸æ˜¯ä»Šå¤©çš„ä¸»é¢˜ï¼Œä¸€å¾‹ä¸è®²ã€‚æˆ‘ä»¬åªè®²ä»£ç ã€‚æˆ‘ä¾æ—§è®°å¾—å½“åˆä½¿ç”¨äº†[MVC](MVCæµ…æ)ï¼ŒModel-View-Controller,ç›¸ä¿¡åœ¨åº§çš„åº”è¯¥éƒ½çŸ¥é“MVCæ˜¯ä½•ç‰©ï¼Œä¸è¿‡è¿˜æ˜¯ç®€å•çš„è¯´æ˜ä¸‹ã€‚å½“æ—¶æƒ³ç€ï¼ŒModelå¤„ç†æ•°æ®,Controllerå¤„ç†è¯·æ±‚ï¼ŒViewå¤„ç†é¡µé¢ï¼Œå¤šä¹ˆperfectçš„å†³å®šã€‚ä½†æ˜¯ä¸ä¹…çš„å°†æ¥å°±æ„Ÿè§‰å½“æ—¶çš„æ— çŸ¥ã€‚çš„ç¡®mvcæ˜¯æœ€å¥½çš„æ¨¡å¼ï¼Œä¹Ÿæ˜¯æœ€åŸºæœ¬çš„æ¨¡å¼ï¼Œå°±æ˜¯æµç¨‹å›¾ä¸­çš„3ä¸­åŸºæœ¬å›¾å½¢ä¸€èˆ¬ï¼Œå¯ä»¥ç»„æˆå„ç§å„æ ·çš„æµç¨‹å›¾ã€‚è¨€å½’æ­£ä¼ ï¼Œä½†æ˜¯è¿˜ç‰¹åˆ«å› ä¸ºæ€•ä¸€ä¸ªæ–¹æ³•å¤ªå¤æ‚ï¼Œå¤„ç†åŠŸèƒ½è¶Šå¤šï¼Œå‡ºé”™çš„æ¦‚ç‡è¶Šå¤šï¼Œç‰¹åœ°æƒ³å¥½çš„ï¼Œä¸€ä¸ªæ–¹æ³•è·å–ä¸€ç§æ•°æ®ï¼Œç„¶åç»“æœå°±æ˜¯ï¼Œæ–¹æ³•æ˜¯è¶Šæ¥è¶Šå¤šï¼Œæ–‡ä»¶æ˜¯è¶Šå†™è¶Šé•¿ã€‚åŠŸèƒ½ä¹Ÿæ˜¯è¶Šå†™è¶Šå¤šã€‚æœ€ç»ˆç»“æœæ˜¯ä¸æ˜¯å°±æ˜¯è¶Šå¥½ç»´æŠ¤å‘¢ã€‚ç„¶è€Œäº‹å®å´æ˜¯æ®‹é…·ï¼Œä»£ç å¤šäº†ï¼Œæ‰¾èµ·æ¥éƒ½éš¾ï¼Œç”šè‡³éƒ½çŸ¥é“æ˜¯åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œäº†ã€‚è¿˜è¦æ‰¾ï¼Œæ›´ä¸è¦è¯´å»ç»´æŠ¤ï¼Œé‡ç”¨äº†ã€‚æˆ–è®¸èƒ½ä¸é”™å°±å·²ç»è°¢å¤©è°¢åœ°äº†å§ã€‚é‚£ä¹ˆåˆè¯¥å¦‚ä½•å‘¢ï¼Ÿå¥½äº†ï¼Œä¸‹é¢å¼€å§‹è¿›å…¥æ­£é¢˜å§ï¼

## MVCæµ…æ
- M:Model(æ¨¡å‹)
- V:View(è§†å›¾)
- C:Controller(æ§åˆ¶å™¨)

ä¸ªäººç†è§£ï¼šControllerç”¨äºæ¥æ”¶è¯·æ±‚ï¼Œç„¶åå»Modelè·å–æ•°æ®ï¼Œå†æŠŠæ•°æ®æ¸²æŸ“åˆ°Viewï¼Œæœ€åæŠŠé¡µé¢å‘ˆç°ç»™ç”¨æˆ·ã€‚

é‚£ä¹ˆä»MVCå®Œæˆçš„åŠŸèƒ½ä¸Šçœ‹ï¼Œç°åœ¨MVCå·²ç»å¾ˆå¥½çš„å®Œæˆäº†åˆ†ç¦»æ•°æ®å’Œè§†å›¾æ“ä½œã€‚

## Repository Pattern
> æ²¡é”™ï¼Œå°±æ˜¯ä»“åº“æ¨¡å¼ã€‚
> é‚£ä¹ˆä»“åº“æ¨¡å¼è¦æ€ä¹ˆç”¨å‘¢ï¼Ÿæˆ–è®¸è¿™æ˜¯é—®çš„æœ€å¤šçš„é—®é¢˜äº†ã€‚

- ä»‹ç»
- åŒ…å®‰è£…
- æ¥å£
- ç›®å½•ç»“æ„
- å®ç°
- æ¡ä»¶
- presenter
- validator

#### ä»‹ç»
æ¦‚å¿µå®šä¹‰ï¼š
A Repository mediates between the domain and data mapping layers, acting like an in-memory domain object collection. Client objects construct query specifications declaratively and submit them to Repository for satisfaction. Objects can be added to and removed from the Repository, as they can from a simple collection of objects, and the mapping code encapsulated by the Repository will carry out the appropriate operations behind the scenes.
ä»“åº“åœ¨é¢†åŸŸé€»è¾‘å’Œæ•°æ®æ˜ å°„å‡ºå‘¢è¿‡,å°±åƒå†…å­˜é¢†åŸŸå¯¹è±¡é›†åˆã€‚å®¢æˆ·å¯¹è±¡å£°æ˜æ€§çš„æ„é€ æŸ¥è¯¢è§„èŒƒå¹¶ä¸”æäº¤åˆ°ä»“åº“ä¸ºäº†æ»¡è¶³æƒ…å†µã€‚å®¢æˆ·å¯ä»¥ä»ä»“åº“è¢«æ·»åŠ å’Œç§»é™¤,å› ä¸ºä»–ä»¬å¯èƒ½æ¥è‡ªç®€å•å¯¹è±¡é›†åˆ,å¹¶ä¸”ç”±ä»“åº“å°è£…çš„æ˜ å°„ä»£ç ä¼šåœ¨å¹•åæ‰§è¡Œç›¸å½“çš„æ“ä½œã€‚

é‚£ä¹ˆåˆ°åº•ä»€ä¹ˆä»“åº“æ¨¡å¼ï¼Œæœ¬è´¨ä¸Šæ¥è¯´ï¼Œä»“åº“èƒ½å¤Ÿä½¿æˆ‘ä»¬æŸ¥è¯¢æ•°æ®çš„æ•°æ®æºï¼Œå°†æ•°æ®æ˜ å°„åˆ°ä¸šåŠ¡å®ä½“å¹¶ä¸”å°†ä¸šåŠ¡å®ä½“çš„æ›´æ”¹ä¿å­˜åˆ°æ•°æ®æºã€‚ç®€å•è¯´ï¼Œä»“åº“é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç”¨æ¥å­˜æ”¾ä¸œè¥¿ï¼Œå–ä¸œè¥¿çš„åœ°æ–¹ï¼Œé‚£ä¹ˆåœ¨ç¨‹åºä¸­ä»“åº“ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚

ä¼˜ç‚¹ï¼š

* æ›´å®¹æ˜“ç»´æŠ¤ä»£ç 
* å‡å°‘ç¨‹åºå‡ºé”™
* å‡å°‘ä»£ç å¤åˆ¶
* ä¸šåŠ¡è·Ÿæ•°æ®åˆ†ç¦»æµ‹è¯•

#### åŒ…å®‰è£…
```php
"bosnadev/repositories": "0.*"
```
1. æŸ¥çœ‹æ¥å£ä¸­æä¾›çš„æ–¹æ³•ï¼Œè¿›è¡ŒåŸºæœ¬ä½¿ç”¨
2. 

#### ä»“åº“æ¨¡å¼çš„æ¥å£
æ¥å£ï¼šå®šä¹‰é€šç”¨æ“ä½œ
ä»“åº“ä¸­çš„æ¥å£å°±ç”¨æ¥å®šä¹‰ä»“åº“çš„ä¸€ç³»åˆ—å…¬å…±çš„æ–¹æ³•ï¼Œæ¯”å¦‚å¸¸è§çš„æœ‰
```php

    public function all($columns = array('*'));

    public function paginate($perPage = 15, $columns = array('*'));

    public function create(array $data);

    public function update(array $data, $id);

    public function delete($id);

    public function find($id, $columns = array('*'));

    public function findBy($field, $value, $columns = array('*'));



#### ç›®å½•ç»“æ„
- Eloquent  -- å…·ä½“å®ç°
- Criterias  -- æ¡ä»¶
- Contracts  -- æ¥å£
- Presenters  -- æ•°æ®é¢„å¤„ç†
- Validators  -- éªŒè¯
- Exceptions  -- å¼‚å¸¸

#### å®ç°
å®šä¹‰æ¥å£ï¼Œç„¶ååœ¨å…·ä½“å®ç°ç±»ä¸­ï¼Œå®ç°è¯¥æ¥å£ã€‚å…·ä½“è§`demo`

#### æ¡ä»¶
æ¡ä»¶ä¹Ÿå¯ä»¥è¯´æ˜¯æŸ¥è¯¢æ ‡å‡†ã€‚æˆ–è€…ä¸Šé¢é‚£ä¸ªé€šç”¨çš„æ–¹æ³•ä»…èƒ½æ»¡è¶³åŸºæœ¬åŠŸèƒ½ã€‚ä½†æ˜¯è¿˜æ˜¯æœ‰è®¸è®¸å¤šå¤šçš„åŠŸèƒ½æ— æ³•å¾—åˆ°æ»¡è¶³ã€‚é‚£ä¹ˆå¼•å…¥æ¡ä»¶æŸ¥è¯¢ï¼Œå®ƒä¸åŒäºscopeï¼Œå› ä¸ºscopeåªèƒ½å®šä¹‰åœ¨ä¸€ä¸ªmodelä¸­ï¼Œå±€é™æ€§å¤ªå¤§ã€‚è€ŒCriterai(æ¡ä»¶ï¼‰ï¼Œæ˜¯é€‚ç”¨äºæ‰€æœ‰çš„Respository

#### presenter 
åœ¨ä»“åº“æ¨¡å¼ä¸­ï¼Œpresenterç”¨æ¥å¯¹æ•°æ®çš„å¤„ç†ï¼Œæ¯”å¦‚è¯´ï¼Œæœ‰ä¸ªå­—æ®µæ˜¯is_success, é‚£ä¹ˆå¾ˆå¤šæ—¶å€™æƒ³ç”¨çš„æ—¶å€™ï¼Œå¯èƒ½å°±éœ€è¦è¿™ä¸ªå­—æ®µå°±æ˜¯booleanç±»å‹ã€‚è€Œpresneterå°±æ˜¯å¤„ç†è¿™ä¸ªçš„

#### validator éªŒè¯
å¯ä»¥åˆ†ç¦»å¼€åˆ›å»ºä»¥åŠä¿®æ”¹

`æ¥ä¸‹æ¥ä¸€ä¸ªä¸ªéªŒè¯`

#### ä½¿ç”¨
1. åˆ›å»ºmodel
    php artisan make:entity Article

![r1.png](r1.png)


